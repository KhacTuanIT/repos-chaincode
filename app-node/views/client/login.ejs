<!-- Begin Li's Breadcrumb Area -->
<div class="breadcrumb-area">
  <div class="container">
    <div class="breadcrumb-content">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li class="active">Login</li>
      </ul>
    </div>
  </div>
</div>
<!-- Li's Breadcrumb Area End Here -->
<!-- Begin Login Content Area -->
<div class="page-section mb-60">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-sm-12 col-md-12 col-xs-12 col-lg-12 mt-3 text-center">
        <span class="alert alert-danger"><%= message %></span>
      </div>
      <div class="col-sm-12 col-md-12 col-xs-12 col-lg-6 mt-3">
        <!-- Login Form s-->
        <form id="form-login">
          <input type="hidden" name="org" value="supply" />
          <div class="login-form">
            <h4 class="login-title">Login</h4>
            <div class="row">
              <div class="col-md-12 col-12 mb-20">
                <label>Username</label>
                <input
                  class="mb-0"
                  name="username"
                  id="username"
                  type="text"
                  placeholder="Username"
                />
                <span
                  id="invalid-username"
                  class="invalid-text-value text-danger"
                ></span>
              </div>
              <div class="col-12 mb-20">
                <label>Password</label>
                <input
                  class="mb-0"
                  type="password"
                  name="password"
                  id="password"
                  placeholder="Password"
                />
                <span
                  id="invalid-password"
                  class="invalid-text-value text-danger"
                ></span>
              </div>
              <div class="col-md-8">
                <div class="check-box d-inline-block ml-0 ml-md-2 mt-10">
                  <input type="checkbox" id="remember_me" />
                  <label for="remember_me">Remember me</label>
                </div>
              </div>
              <div class="col-md-4 mt-10 mb-20 text-left text-md-right">
                <a href="#"> Forgotten password?</a>
              </div>
              <div class="col-md-4">
                <button
                  type="button"
                  id="login-btn"
                  class="register-button mt-0"
                >
                  Login
                </button>
              </div>
              <div class="col-md-8 text-right text-md-right">
                Create new account? <a href="/register">Register</a>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Login Content Area End Here -->

<script>
    function clearAfterDelay(e) {
      setTimeout(() => {
        e.text("");
      }, 15000);
    }
    $(document).on("click", "#login-btn", function () {
      $.ajax({
        url: "/login",
        type: "post",
        data: $("#form-login").serialize(),
        success: function (res) {
          if (res.status) {
            if (window.location.pathname.includes('login')) {
              window.location.href = "/";
            }
            else {
              window.location.href = window.location.href;
            }
          }
          else {
            toastr.danger(
              res.message ? res.message : "Server is updating now..."
            );
          }
        },
        error: function (jq, status, err) {
          let responseError = JSON.parse(jq.responseText);
          console.log(responseError);
          responseError.errors.forEach((error) => {
            if (!$("#" + error.param).hasClass("invalid-error-input")) {
              $("#" + error.param).addClass("invalid-error-input");
              setTimeout(() => {
                if ($("#" + error.param).hasClass("invalid-error-input")) {
                  $("#" + error.param).removeClass("invalid-error-input");
                }
              }, 5000);
            }
            $("#invalid-" + error.param).text(error.msg);
            clearAfterDelay($("#invalid-" + error.param));
          });
        },
      });
    });
  </script>